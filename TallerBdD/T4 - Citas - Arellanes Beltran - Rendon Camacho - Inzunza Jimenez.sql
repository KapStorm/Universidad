CREATE DATABASE citas
GO
USE citas
GO

-------------------
-- CREATE TABLES --
-------------------
CREATE TABLE HOSPITALES (
HospId INT NOT NULL,
HospNombre NVARCHAR(20) NOT NULL,
HospDireccion NVARCHAR(50) NOT NULL,
HospTelefono NCHAR(10) NOT NULL
)
GO
CREATE TABLE CONSULTORIOS (
ConsultId INT NOT NULL,
ConsultUbic NVARCHAR(30) NOT NULL,
ConsultNombre NVARCHAR(20) NOT NULL,
HospId INT NOT NULL
)
GO
CREATE TABLE ESPECIALIDAD (
EspecId INT NOT NULL,
EspecNombre NVARCHAR(20) NOT NULL
)
GO
CREATE TABLE DOCTORES (
DocId INT NOT NULL,
DocNombres NVARCHAR(20) NOT NULL,
DocApePat NVARCHAR(20) NOT NULL,
DocApeMat NVARCHAR(20) NULL,
DocTel NCHAR(10) NOT NULL
)
CREATE TABLE ESPXDOC (
EspecId INT NOT NULL,
DocId INT NOT NULL
)
GO
GO
CREATE TABLE PACIENTES (
PacId INT NOT NULL,
PacNombres NVARCHAR(20) NOT NULL,
PacApePat NVARCHAR(20) NOT NULL,
PacApeMat NVARCHAR(20) NULL,
PacTel NCHAR(10) NOT NULL,
PacCorreo NVARCHAR(30) NOT NULL,
PacDireccion NVARCHAR(50) NOT NULL,
)
GO
CREATE TABLE CITAS (
Folio INT NOT NULL,
CitaPresion NVARCHAR(10) NOT NULL,
CitaPeso NUMERIC(6, 2) NOT NULL,
CitaAltura NUMERIC(6, 2) NOT NULL,
CitaSintomas NVARCHAR(50) NOT NULL,
CitaDiagnostico NVARCHAR(50) NOT NULL,
CitaFecha DATE NOT NULL,
CitaFechaCaptura DATE NOT NULL,
DocId INT NOT NULL,
PacId INT NOT NULL,
ConsultId INT NOT NULL
)
GO
CREATE TABLE MEDICAMENTOS (
MedId INT NOT NULL,
MedNombre NVARCHAR(20) NOT NULL,
MedDescripcion NVARCHAR(50) NOT NULL,
MedicSustAct NVARCHAR(20) NOT NULL,
LabId INT NOT NULL
)
GO
CREATE TABLE LABORATORIOS (
LabId INT NOT NULL,
LabNombre NVARCHAR(20) NOT NULL,
LabDireccion NVARCHAR(50) NOT NULL,
LabTelefono NCHAR(10) NOT NULL
)
GO
CREATE TABLE RECETAS (
FolioRec INT NOT NULL,
RecFecha DATE NOT NULL,
Folio INT NOT NULL
)
GO
CREATE TABLE MEDXRECETAS (
FolioRec INT NOT NULL,
MedId INT NOT NULL,
RecDosis NVARCHAR(50) NOT NULL
)
GO

------------------
-- PRIMARY KEYS --
------------------
ALTER TABLE LABORATORIOS ADD
CONSTRAINT PK_LabId PRIMARY KEY (LabId)
GO
ALTER TABLE MEDICAMENTOS ADD
CONSTRAINT PK_MedID PRIMARY KEY (MedId)
GO
ALTER TABLE CONSULTORIOS ADD
CONSTRAINT PK_ConsultId PRIMARY KEY (ConsultId)
GO
ALTER TABLE HOSPITALES ADD
CONSTRAINT PK_HospId PRIMARY KEY (HospId)
GO
ALTER TABLE ESPECIALIDAD ADD
CONSTRAINT PK_EspecId PRIMARY KEY (EspecId)
GO
ALTER TABLE DOCTORES ADD
CONSTRAINT PK_DocId PRIMARY KEY (DocId)
GO
ALTER TABLE PACIENTES ADD
CONSTRAINT PK_PacId PRIMARY KEY (PacId)
GO
ALTER TABLE CITAS ADD
CONSTRAINT PK_Folio PRIMARY KEY (Folio)
GO
ALTER TABLE RECETAS ADD
CONSTRAINT PK_FolioRec PRIMARY KEY (FolioRec)
GO

------------------
-- FOREIGN KEYS --
------------------
ALTER TABLE MEDICAMENTOS ADD CONSTRAINT FK_Medicamentos_Laboratorios
FOREIGN KEY (LabId) REFERENCES LABORATORIOS (LabId)
GO
ALTER TABLE MEDXRECETAS ADD CONSTRAINT FK_Medicamentos_Recetas_Citas
FOREIGN KEY (MedId) REFERENCES MEDICAMENTOS (MedId),
FOREIGN KEY (FolioRec) REFERENCES RECETAS (FolioRec)
GO
ALTER TABLE CONSULTORIOS ADD CONSTRAINT FK_Consultorio_Hospitales
FOREIGN KEY (HospId) REFERENCES Hospitales (HospId)
GO
ALTER TABLE CITAS ADD CONSTRAINT FK_Citas_RegistroCitas
FOREIGN KEY (DocId) REFERENCES DOCTORES (DocId),
FOREIGN KEY (PacId) REFERENCES PACIENTES (PacId),
FOREIGN KEY (ConsultId) REFERENCES CONSULTORIOS (ConsultId)
GO
ALTER TABLE ESPXDOC ADD CONSTRAINT FK_Especialidad_Doctores
FOREIGN KEY (DocId) REFERENCES DOCTORES (DocId),
FOREIGN KEY (EspecId) REFERENCES ESPECIALIDAD (EspecId)
GO
ALTER TABLE RECETAS ADD CONSTRAINT FK_Receta_MedxRec
FOREIGN KEY (Folio) REFERENCES CITAS (Folio)
GO


-----------------------
-- UNIQUE CONSTRAINT --
-----------------------
ALTER TABLE RECETAS ADD
CONSTRAINT UC_Folio UNIQUE (Folio)
GO
ALTER TABLE PACIENTES ADD
CONSTRAINT UC_PacCorreo UNIQUE (PacCorreo)
GO

--------------------------
-- VALORES PREDEFINIDOS --
--------------------------
ALTER TABLE PACIENTES ADD
CONSTRAINT CD_PacApeMat DEFAULT('Sin apellido materno') FOR PacApeMat,
CONSTRAINT CD_PacTel DEFAULT('0000000000') FOR PacTel,
CONSTRAINT CD_PacCorreo DEFAULT('Sin correo') FOR PacCorreo,
CONSTRAINT CD_PacDireccion DEFAULT('Sin direccion de domicilio') FOR PacDireccion
GO
ALTER TABLE DOCTORES ADD
CONSTRAINT CD_DocApePat DEFAULT('Sin apellido paterno') FOR DocApePat,
CONSTRAINT CD_DocApeMat DEFAULT('Sin apellido MATERNO') FOR DocApeMat,
CONSTRAINT CD_DocTel DEFAULT('0000000000') FOR DocTel
GO
ALTER TABLE CITAS ADD
CONSTRAINT CD_Sintomas DEFAULT('Sin sintomas') FOR CitaSintomas,
CONSTRAINT CD_Diagnostico DEFAULT('Sin diagnostico') FOR CitaDiagnostico
GO

---------------------------------
-- RESTRICCIÓN DE COMPROBACIÓN --
---------------------------------
ALTER TABLE CITAS ADD
CONSTRAINT CC_Citas_Peso_Minimo CHECK (CitaPeso > 0),
CONSTRAINT CC_Citas_Altura_Minimo CHECK (CitaAltura > 0),
CONSTRAINT CC_Citas_Fecha_Minimo CHECK (CitaFecha > '2021-01-01'),
CONSTRAINT CC_Citas_FechaCaptura_Minimo CHECK (CitaFechaCaptura > '2021-01-01'),
CONSTRAINT CC_Citas_Fecha_FechaCaptura CHECK (CitaFecha >= CitaFechaCaptura),
CONSTRAINT CC_Citas_Sintomas_Len CHECK (LEN(CitaSintomas) > 5)
GO
ALTER TABLE DOCTORES ADD
CONSTRAINT CC_Doctores_Nombres_Len CHECK (LEN(DocNombres) > 2),
CONSTRAINT CC_Doctores_ApePat_Len CHECK (LEN(DocApePat) > 2),
CONSTRAINT CC_Doctores_Tel_Len CHECK (LEN(DocTel) = 10),
CONSTRAINT CC_Doctores_Tel_Numeros CHECK (DocTel LIKE '[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]')
GO
ALTER TABLE HOSPITALES ADD
CONSTRAINT CC_Hosptiales_Tel_Len CHECK (LEN(HospTelefono) = 10),
CONSTRAINT CC_Hospitales_Tel_Numeros CHECK (HospTelefono LIKE '[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]')
GO
ALTER TABLE LABORATORIOS ADD
CONSTRAINT CC_Laboratorios_Tel_Len CHECK (LEN(LabTelefono) = 10),
CONSTRAINT CC_Laboratorios_Tel_Numeros CHECK (LabTelefono LIKE '[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]')
GO
ALTER TABLE MEDXRECETAS ADD
CONSTRAINT CC_MedXRecetas_Dosis_Minimo CHECK (LEN(RecDosis) > 0)
GO
ALTER TABLE PACIENTES ADD
CONSTRAINT CC_Pacientes_Nombres_Len CHECK (LEN(PacNombres) > 2),
CONSTRAINT CC_Pacientes_ApePat_Len CHECK (LEN(PacApePat) > 2),
CONSTRAINT CC_Pacientes_Tel_Len CHECK (LEN(PacTel) = 10),
CONSTRAINT CC_Pacientes_Tel_Numeros CHECK (PacTel LIKE '[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]'),
CONSTRAINT CC_Pacientes_Correo_Valido CHECK (PacCorreo LIKE  '%_@__%.__%')
GO
ALTER TABLE RECETAS ADD
CONSTRAINT CC_Recetas_Fecha_Minimo CHECK (RecFecha > '2021-01-01')
GO


-----------------
-- INSERCIONES --
-----------------
INSERT INTO ESPECIALIDAD VALUES(1, 'Nutrición')
GO
INSERT INTO ESPECIALIDAD VALUES(2, 'Cardiología')
GO
INSERT INTO ESPECIALIDAD VALUES(3, 'Neurología')
GO
INSERT INTO ESPECIALIDAD VALUES(4, 'Pediatría')
GO
INSERT INTO ESPECIALIDAD VALUES(5, 'Reumatología')
GO

--INSERCIONES DE TABLA DOCTORES
INSERT INTO DOCTORES VALUES(1,'Francisco','Perez','Ramirez','6678093445')
GO
INSERT INTO DOCTORES VALUES(2,'Enrique','Castro','Cruz','6678086524')
GO
INSERT INTO DOCTORES VALUES(3,'María','Castañeda','Baca','6678093412')
GO
INSERT INTO DOCTORES VALUES(4,'Perla','Ramirez','Peña','6678893322')
GO
INSERT INTO DOCTORES VALUES(5,'Bryan','Inzunza','Jimenez','6678563423')
GO

--INSERCIONES DE TABLA ESXXDOC
INSERT INTO ESPXDOC VALUES(1, 3)
GO
INSERT INTO ESPXDOC VALUES(2, 2)
GO
INSERT INTO ESPXDOC VALUES(3, 1)
GO
INSERT INTO ESPXDOC VALUES(4, 4)
GO
INSERT INTO ESPXDOC VALUES(5, 5)
GO

--INSERCIONES DE TABLA HOSPITALES
INSERT INTO HOSPITALES VALUES(1,'IMSS','Calle Ramirez, Colonia Hidalgo','6678901256') 
GO
INSERT INTO HOSPITALES VALUES(2,'ISSTE','Calle Sanchez, Colonia Centro','6678674512') 
GO
INSERT INTO HOSPITALES VALUES(3,'Los Angeles','Calle Zapata, Colonia Centro','6678894583') 
GO
INSERT INTO HOSPITALES VALUES(4,'Cruz Roja','Calle Obregon, Colonia Centro','6678450044') 
GO
INSERT INTO HOSPITALES VALUES(5,'Central','Calle luto, Colonia Angeles','6678896545') 
GO

--INSERCIONES DE TABLA CONSULTORIOS
INSERT INTO CONSULTORIOS VALUES(1,'Piso 4, Area C','Consultorio 8', 4)
GO
INSERT INTO CONSULTORIOS VALUES(2,'Piso 1, Area A','Consultorio 1', 5)
GO
INSERT INTO CONSULTORIOS VALUES(3,'Piso 1, Area A','Consultorio 2', 5)
GO
INSERT INTO CONSULTORIOS VALUES(4,'Piso 2, Area B','Consultorio 6', 4)
GO
INSERT INTO CONSULTORIOS VALUES(5,'Piso 4, Area C','Consultorio 9', 4)
GO

--INSERCIONES DE TABLA PACIENTES
INSERT INTO PACIENTES VALUES(1,'Sebastian','Arellanes','Beltran','6678126755','sebas2002@hotmail.com','Calle Fernando Cuen, Col Centro')
GO
INSERT INTO PACIENTES VALUES(2,'Fernando','Moreno','Millan','6678546722','fernis55@hotmail.com','Calle Fernando Esparza, Col QUINTAS')
GO
INSERT INTO PACIENTES VALUES(3,'Miguel','Calderon','Ceballos','6678894312','cal76@hotmail.com','Calle Quel, Col Mandarina')
GO
INSERT INTO PACIENTES VALUES(4,'Ricardo','Valenzuela','Rivera','6678893411','ric78@hotmail.com','Calle Lol, Col Barrio')
GO
INSERT INTO PACIENTES VALUES(5,'Ryan','Felix','Fierro','6678893466','Ryan2002@hotmail.com','Calle Feero, Col Ruiz')
GO


--INSERCIONES DE CITAS
INSERT INTO CITAS VALUES(1,'120/75', 75, 170,'Temperatura alta y dolor estomocal','Infeccion en el estomago','2022-07-17','2022-07-15',5,2,2)
GO
INSERT INTO CITAS VALUES(2,'120/80', 65, 180,'Temperatura alta y bajo peso','Anemia','2022-07-18','2022-07-16',4,3,2)
GO
INSERT INTO CITAS VALUES(3,'110/70', 61, 165,'Temperatura alta y alto peso','Sobrepeso','2022-06-17','2022-06-15',3,4,3)
GO
INSERT INTO CITAS VALUES(4,'110/80', 81, 175,'Temperatura alta y dolor en el pecho','Cancer','2022-08-11','2022-08-11',2,5,3)
GO
INSERT INTO CITAS VALUES(5,'130/60', 91, 185,'Temperatura alta y dolor en el pecho','Pulmonia','2022-04-05','2022-04-03',5,1,1)
GO

--INSERCIONES DE LABORATORIO
INSERT INTO LABORATORIOS VALUES(1,'Del Valle','Calle Damy, Colonia Colon','6678903412')
GO
INSERT INTO LABORATORIOS VALUES(2,'Lab','Calle Augusto, Colonia PEMEX','6678543378')
GO
INSERT INTO LABORATORIOS VALUES(3,'LAB Tec','Calle Lugo, Colonia Centro','6678347766')
GO
INSERT INTO LABORATORIOS VALUES(4,'Del Rio','Calle Rio, Colonia Angeles','6678659944')
GO
INSERT INTO LABORATORIOS VALUES(5,'Del Gol','Calle Dorado, Colonia Centro','6678452377')
GO

--INSERCIONES DE MEDICAMENTOS
INSERT INTO MEDICAMENTOS VALUES(1,'Ibuprofeno','Medicamento para el dolor de cabeza','Mezcla 1',2)
GO
INSERT INTO MEDICAMENTOS VALUES(2,'Paracetamol','Medicamento para el dolor de cabeza','Mezcla 2',2)
GO
INSERT INTO MEDICAMENTOS VALUES(3,'Lactobacilos','Medicamento para el estomago','Mezcla 2',4)
GO
INSERT INTO MEDICAMENTOS VALUES(4,'Jarabes','Larga lista','Mezcla 3',4)
GO
INSERT INTO MEDICAMENTOS VALUES(5,'Omeprazol','Medicamento para el estomagi','Mezcla 1',5)
GO

--INSERCIONES DE RECETASs
INSERT INTO RECETAS VALUES(1,'2022-08-17',1)
GO
INSERT INTO RECETAS VALUES(2,'2022-09-17',2)
GO
INSERT INTO RECETAS VALUES(3,'2022-05-17',3)
GO
INSERT INTO RECETAS VALUES(4,'2022-04-17',4)
GO
INSERT INTO RECETAS VALUES(5,'2022-03-17',5)
GO

--INSERCIONES DE MedxReceras
INSERT INTO MEDXRECETAS VALUES(2,2,'3 Tabletas al dia')
GO
INSERT INTO MEDXRECETAS VALUES(1,1,'3 cucharadas al dia')
GO
INSERT INTO MEDXRECETAS VALUES(3,3,'5 pastillas semanales')
GO
INSERT INTO MEDXRECETAS VALUES(5,5,'3 Tabletas a la semana')
GO
INSERT INTO MEDXRECETAS VALUES(5,4,'3 Tabletas al mes')
GO
